(window.pwWpJsonP=window.pwWpJsonP||[]).push([[11],{103:function(t,e,s){"use strict";s.d(e,"a",(function(){return r}));var a=s(6);class r{getAll(){return this._createRequest("settings")}get(t){return this._createRequest("settings/"+t)}set(t,e){return this._createRequest("settings/"+t,{value:e},"PUT")}reset(t){return this._createRequest("settings/"+t,null,"DELETE")}listCaches(){return this._createRequest("caches")}clearCache(t){return this._createRequest("caches/"+t,null,"DELETE")}async _createRequest(t,e=null,s="GET"){let n={method:s,credentials:"include"};n.headers=new Headers,n.headers.append("Accept","application/json, text/plain, */*"),n.headers.append("requesttoken",OC.requestToken),e&&("GET"===s&&(n.method="POST"),n.headers.append("Content-Type","application/json"),n.body=JSON.stringify(e));try{let e=a.a.generateUrl("/apps/passwords/admin/"+t),s=await fetch(new Request(e,n));return await r._processResponse(s)}catch(t){throw console.error("Request failed",t),t}}static async _processResponse(t){if(!t.ok)throw console.error(t),new Error("Api request failed");let e=t.headers.get("content-type");if(e&&-1!==e.indexOf("application/json"))return await t.json();throw console.error("Invalid response format",t),new Error("Invalid response format")}}},292:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"background",attrs:{id:"passwords-setup"},on:{click:function(e){return t.closeAction(e)}}},[s("div",{attrs:{id:"setup-container"}},[s("div",{staticClass:"setup-header"},[s("div",{staticClass:"logo"}),t._v(" "),s("translate",{attrs:{tag:"h1",say:t.current.title}})],1),t._v(" "),s("ul",{staticClass:"setup-content",style:t.getStyle},[t.hasSlide("start")?s("start",{staticClass:"slide",attrs:{id:"setup-slide-start"}}):t._e(),t._v(" "),t.hasSlide("encryption")?s("encryption",{staticClass:"slide",attrs:{id:"setup-slide-encryption","is-current":1===t.currentId},on:{status:t.updateStatus,continue:t.nextSlide}}):t._e(),t._v(" "),t.hasSlide("admin-settings")?s("admin-settings",{staticClass:"slide",attrs:{id:"setup-slide-admin-settings"}}):t._e(),t._v(" "),t.hasSlide("user-settings")?s("user-settings",{staticClass:"slide",attrs:{id:"setup-slide-user-settings"}}):t._e(),t._v(" "),t.hasSlide("get-help")?s("get-help",{staticClass:"slide",attrs:{id:"setup-slide-get-help"},on:{redirect:function(e){return t.openSection(e,!1)}}}):t._e(),t._v(" "),t.hasSlide("keep-order")?s("keep-order",{staticClass:"slide",attrs:{id:"setup-slide-keep-order"}}):t._e(),t._v(" "),t.hasSlide("integrations")?s("integrations",{staticClass:"slide",attrs:{id:"setup-slide-integrations"},on:{redirect:t.openSection}}):t._e()],1),t._v(" "),s("div",{staticClass:"setup-navigation"},[t.showSkipButton?s("translate",{staticClass:"skip",attrs:{tag:"div",say:"Skip"},on:{click:t.nextSlide}}):t._e(),t._v(" "),t.showCustomButton?s("translate",{staticClass:"continue",class:t.current.action.class,attrs:{tag:"div",say:t.current.action.label},on:{click:t.current.action.click}}):t._e(),t._v(" "),t.showCustomButton?t._e():s("translate",{staticClass:"continue",attrs:{tag:"div",say:t.continueText},on:{click:t.nextSlide}})],1)])])};a._withStripped=!0;var r=s(0),n=s(18),i=s(7),o=function(){var t=this.$createElement;return(this._self._c||t)("li",{style:this.getStyle})};o._withStripped=!0;var l={computed:{getStyle:()=>({"background-image":"url("+OC.appswebroots.firstrunwizard+"/img/intro.png)"})}},c=(s(377),s(4)),u=Object(c.a)(l,o,[],!1,null,null,null);u.options.__file="src/vue/Dialog/SetupDialog/Start.vue";var d=u.exports,p=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("li",[s("p",[s("translate",{attrs:{say:"Whenever you don't know how something works, have questions or need help with a problem:"}}),t._v(" "),s("translate",{attrs:{say:"Help is just around the corner."}}),t._v(" "),s("translate",{attrs:{say:'Our built-in handbook can be found by clicking on "More" and explains the app in all details.'}}),t._v(" "),s("translate",{attrs:{say:"In any other case, our community is the right place to ask your questions."}})],1),t._v(" "),s("div",{staticClass:"help-options"},[s("translate",{attrs:{tag:"a",say:"Handbook",icon:"book"},on:{click:function(e){return e.preventDefault(),t.openHelp(e)}}}),t._v(" "),s("web",{attrs:{text:"Forum",icon:"users",target:"_blank",href:"https://help.nextcloud.com/c/apps/passwords"}}),t._v(" "),s("web",{attrs:{text:"Chat",icon:"telegram",href:"https://t.me/nc_passwords"}})],1)])};p._withStripped=!0;var h=s(2),g={components:{Web:s(35).a,Translate:i.a},methods:{openHelp(){this.$emit("redirect",{path:"/help"}),h.a.notification("Handbook will be opened after the tutorial")}}},v=(s(379),Object(c.a)(g,p,[],!1,null,null,null));v.options.__file="src/vue/Dialog/SetupDialog/GetHelp.vue";var y=v.exports,w=function(){var t=this.$createElement,e=this._self._c||t;return e("li",[e("div",[e("video",{attrs:{width:"100%",src:this.imagePath}})])])};w._withStripped=!0;var m={components:{Translate:i.a},computed:{imagePath:()=>OC.appswebroots.passwords+"/img/demo-folders.webm"}},_=(s(381),Object(c.a)(m,w,[],!1,null,null,null));_.options.__file="src/vue/Dialog/SetupDialog/KeepOrder.vue";var f=_.exports,b=s(5),S=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("li",[s("p",[s("translate",{attrs:{say:"Passwords offers modern and strong encryption to protect your data from prying eyes."}}),t._v(" "),s("translate",{attrs:{say:"Choose a secure password below to activate the ultimate protection for your passwords."}})],1),t._v(" "),t.processing?t._e():s("form",{on:{submit:t.setPassword}},[s("div",{staticClass:"password-setup"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],attrs:{type:"password",placeholder:t.getPasswordPlaceholder,pattern:".{12,}",readonly:""},domProps:{value:t.password},on:{input:function(e){e.target.composing||(t.password=e.target.value)}}}),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.confirm,expression:"confirm"}],attrs:{type:"password",placeholder:t.getPasswordRepeatPlaceholder},domProps:{value:t.confirm},on:{input:function(e){e.target.composing||(t.confirm=e.target.value)}}}),t._v(" "),t.advanced?s("div",{staticClass:"advanced"},[s("div",[s("input",{directives:[{name:"model",rawName:"v-model",value:t.encryptDb,expression:"encryptDb"}],attrs:{type:"checkbox",id:"encrypt-all"},domProps:{checked:Array.isArray(t.encryptDb)?t._i(t.encryptDb,null)>-1:t.encryptDb},on:{change:function(e){var s=t.encryptDb,a=e.target,r=!!a.checked;if(Array.isArray(s)){var n=t._i(s,null);a.checked?n<0&&(t.encryptDb=s.concat([null])):n>-1&&(t.encryptDb=s.slice(0,n).concat(s.slice(n+1)))}else t.encryptDb=r}}}),t._v(" "),s("translate",{attrs:{tag:"label",for:"encrypt-all",say:"Encrypt my existing passwords"}})],1),t._v(" "),s("div",[s("input",{directives:[{name:"model",rawName:"v-model",value:t.savePassword,expression:"savePassword"}],attrs:{type:"checkbox",id:"save-password"},domProps:{checked:Array.isArray(t.savePassword)?t._i(t.savePassword,null)>-1:t.savePassword},on:{change:function(e){var s=t.savePassword,a=e.target,r=!!a.checked;if(Array.isArray(s)){var n=t._i(s,null);a.checked?n<0&&(t.savePassword=s.concat([null])):n>-1&&(t.savePassword=s.slice(0,n).concat(s.slice(n+1)))}else t.savePassword=r}}}),t._v(" "),s("translate",{attrs:{tag:"label",for:"save-password",say:"Save the password"}})],1)]):t._e()])]),t._v(" "),t.processing?s("div",{staticClass:"encryption-status"},[s("translate",{attrs:{tag:"h2",say:"Installing Encryption"}}),t._v(" "),s("div",[s("translate",{attrs:{say:"Keychain"}}),t._v(" "),s("span",{class:t.getKeychainClass},[t._v(t._s(t.getKeychainStatus))])],1),t._v(" "),t.encryptDb?s("div",[s("translate",{attrs:{say:"Folders"}}),t._v(" "),s("span",{class:t.getFolderClass},[t._v(t._s(t.getFolderStatus))])],1):t._e(),t._v(" "),t.encryptDb?s("div",[s("translate",{attrs:{say:"Tags"}}),t._v(" "),s("span",{class:t.getTagsClass},[t._v(t._s(t.getTagsStatus))])],1):t._e(),t._v(" "),t.encryptDb?s("div",[s("translate",{attrs:{say:"Passwords"}}),t._v(" "),s("span",{class:t.getPasswordsClass},[t._v(t._s(t.getPasswordsStatus))])],1):t._e(),t._v(" "),t.encryptDb?s("div",[s("translate",{attrs:{say:"Clean up"}}),t._v(" "),s("span",{class:t.getCleanupClass},[t._v(t._s(t.getCleanupStatus))])],1):t._e(),t._v(" "),t.ready&&!t.hasError?s("translate",{staticClass:"result success",attrs:{tag:"div",say:"Success"}}):t._e(),t._v(" "),t.hasError?s("translate",{staticClass:"result failure",attrs:{tag:"div",say:"Failed"}}):t._e()],1):t._e()])};S._withStripped=!0;var k=s(1),A=s(309),P={components:{Translate:i.a},props:{isCurrent:{type:Boolean,default:!1}},data:()=>({password:"",confirm:"",processing:!1,ready:!1,hasError:!1,advanced:b.a.get("client.settings.advanced"),savePassword:!0,encryptDb:!0,status:{keychain:{status:"waiting",current:0,total:0},folders:{status:"waiting",current:0,total:0},tags:{status:"waiting",current:0,total:0},passwords:{status:"waiting",current:0,total:0},cleanup:{status:"waiting",current:0,total:0}}}),created(){setTimeout(()=>{document.querySelector(".password-setup > [type=password]").removeAttribute("readonly")},250)},computed:{getPasswordPlaceholder:()=>k.a.translate("Password"),getPasswordRepeatPlaceholder:()=>k.a.translate("Repeat your password"),getKeychainClass(){return this.getStatusClass("keychain")},getFolderClass(){return this.getStatusClass("folders")},getTagsClass(){return this.getStatusClass("tags")},getPasswordsClass(){return this.getStatusClass("passwords")},getCleanupClass(){return this.getStatusClass("cleanup")},getKeychainStatus(){return this.getStatusText("keychain")},getFolderStatus(){return this.getStatusText("folders")},getTagsStatus(){return this.getStatusText("tags")},getPasswordsStatus(){return this.getStatusText("passwords")},getCleanupStatus(){return this.getStatusText("cleanup")}},methods:{getStatusClass(t){return this.hasError&&"success"!==this.status[t].status?"status failed":"waiting"===this.status[t].status?"status loading":"status "+this.status[t].status},getStatusText(t){return"failed"===this.status[t].status||this.hasError?"✖":"processing"===this.status[t].status?this.status[t].current+" / "+this.status[t].total:"success"===this.status[t].status?"✔":void 0},async setPassword(){if(!this.processing){this.processing=!0,this.sendStatusEvent();try{await A.a.install(this.password,this.savePassword,this.encryptDb,t=>{this.updateEncryptionStatus(t)})}catch(t){console.error(t)}this.ready=!0,this.sendStatusEvent()}},updateEncryptionStatus(t){for(let e in this.status)this.status.hasOwnProperty(e)&&(this.status[e].current=t[e].current,this.status[e].status=t[e].status,this.status[e].total=t[e].total,"failed"===t[e].status&&(this.hasError=!0));"failed"===t.keychain.status&&(this.hasError=!0)},sendStatusEvent(){let t={action:{label:"Save",class:"disabled",click:()=>{}},skippable:!this.processing,id:"encryption"};this.password.length>12&&this.password===this.confirm&&!this.processing&&(t.action.class="",t.action.click=t=>{this.setPassword(t)}),this.ready&&(t.action.label="Continue",t.action.class="",t.action.click=t=>{this.$emit("continue",{})}),this.$emit("status",t)}},watch:{isCurrent(t){t&&this.sendStatusEvent()},confirm(){this.sendStatusEvent()},password(){this.sendStatusEvent()}}},C=(s(383),Object(c.a)(P,S,[],!1,null,null,null));C.options.__file="src/vue/Dialog/SetupDialog/Encryption.vue";var x=C.exports,E=function(){var t=this.$createElement,e=this._self._c||t;return e("li",[e("p",[e("translate",{attrs:{say:"Access your passwords with ease from anywhere, thanks to our apps and extensions."}}),this._v(" "),e("translate",{attrs:{say:'You can find our Apps and Extensions section in "More" or just click the button below.'}})],1),this._v(" "),e("translate",{staticClass:"setup-cta",attrs:{tag:"div",say:"Go to Apps and Extensions"},on:{click:this.openApps}})],1)};E._withStripped=!0;var O={components:{Translate:i.a},methods:{openApps(){this.$emit("redirect",{path:"/apps"})}}},T=(s(385),Object(c.a)(O,E,[],!1,null,null,null));T.options.__file="src/vue/Dialog/SetupDialog/Integrations.vue";var D=T.exports,j=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("li",[s("p",[s("translate",{attrs:{say:"There are many settings so you can customize your experience."}}),t._v(" "),s("translate",{attrs:{say:'You can find all of them in "More", but we put the most common here:'}})],1),t._v(" "),s("div",{staticClass:"app-settings-container"},[s("translate",{attrs:{tag:"label",for:"settings-section",say:"After launch, show my"}}),t._v(" "),s("select",{directives:[{name:"model",rawName:"v-model",value:t.section,expression:"section"}],attrs:{id:"settings-section"},on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.section=e.target.multiple?s:s[0]}}},[s("translate",{attrs:{tag:"option",value:"folders",say:"folders"}}),t._v(" "),s("translate",{attrs:{tag:"option",value:"tags",say:"tags"}}),t._v(" "),s("translate",{attrs:{tag:"option",value:"favorites",say:"favorites"}}),t._v(" "),s("translate",{attrs:{tag:"option",value:"all",say:"passwords"}}),t._v(" "),s("translate",{attrs:{tag:"option",value:"recent",say:"recently changed"}})],1),t._v(" "),s("translate",{staticClass:"header",attrs:{tag:"div",say:"Mark my passwords if..."}}),t._v(" "),s("div",{staticClass:"setting"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.hasAge,expression:"hasAge"}],attrs:{type:"checkbox",id:"settings-has-age"},domProps:{checked:Array.isArray(t.hasAge)?t._i(t.hasAge,null)>-1:t.hasAge},on:{change:function(e){var s=t.hasAge,a=e.target,r=!!a.checked;if(Array.isArray(s)){var n=t._i(s,null);a.checked?n<0&&(t.hasAge=s.concat([null])):n>-1&&(t.hasAge=s.slice(0,n).concat(s.slice(n+1)))}else t.hasAge=r}}}),t._v(" "),s("translate",{attrs:{tag:"label",say:"they are older than",for:"settings-has-age"}}),t._v(" "),s("select",{directives:[{name:"model",rawName:"v-model.number",value:t.maxAge,expression:"maxAge",modifiers:{number:!0}}],attrs:{id:"settings-age",disabled:!t.hasAge},on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(e){var s="_value"in e?e._value:e.value;return t._n(s)}));t.maxAge=e.target.multiple?s:s[0]}}},[s("translate",{attrs:{tag:"option",value:"90",say:"three months"}}),t._v(" "),s("translate",{attrs:{tag:"option",value:"180",say:"six months"}}),t._v(" "),s("translate",{attrs:{tag:"option",value:"356",say:"one year"}}),t._v(" "),s("translate",{attrs:{tag:"option",value:"712",say:"two years"}}),t._v(" "),t.customAge?s("translate",{attrs:{tag:"option",value:t.customAge,say:"{days} days",variables:{days:t.customAge}}}):t._e()],1)],1),t._v(" "),s("div",{staticClass:"setting"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.duplicates,expression:"duplicates"}],attrs:{type:"checkbox",id:"settings-duplicates"},domProps:{checked:Array.isArray(t.duplicates)?t._i(t.duplicates,null)>-1:t.duplicates},on:{change:function(e){var s=t.duplicates,a=e.target,r=!!a.checked;if(Array.isArray(s)){var n=t._i(s,null);a.checked?n<0&&(t.duplicates=s.concat([null])):n>-1&&(t.duplicates=s.slice(0,n).concat(s.slice(n+1)))}else t.duplicates=r}}}),t._v(" "),s("translate",{attrs:{tag:"label",say:"they are duplicates",for:"settings-duplicates"}})],1),t._v(" "),s("div",{staticClass:"header"},[s("translate",{attrs:{tag:"label",say:"Make my new passwords",for:"settings-strength"}}),t._v(" "),s("select",{directives:[{name:"model",rawName:"v-model.number",value:t.strength,expression:"strength",modifiers:{number:!0}}],attrs:{id:"settings-strength"},on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(e){var s="_value"in e?e._value:e.value;return t._n(s)}));t.strength=e.target.multiple?s:s[0]}}},[s("translate",{attrs:{tag:"option",value:"1",say:"strong"}}),t._v(" "),s("translate",{attrs:{tag:"option",value:"2",say:"stronger"}}),t._v(" "),s("translate",{attrs:{tag:"option",value:"3",say:"very strong"}}),t._v(" "),s("translate",{attrs:{tag:"option",value:"4",say:"extremely strong"}})],1)],1),t._v(" "),s("div",{staticClass:"setting"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.numbers,expression:"numbers"}],attrs:{type:"checkbox",id:"settings-numbers"},domProps:{checked:Array.isArray(t.numbers)?t._i(t.numbers,null)>-1:t.numbers},on:{change:function(e){var s=t.numbers,a=e.target,r=!!a.checked;if(Array.isArray(s)){var n=t._i(s,null);a.checked?n<0&&(t.numbers=s.concat([null])):n>-1&&(t.numbers=s.slice(0,n).concat(s.slice(n+1)))}else t.numbers=r}}}),t._v(" "),s("translate",{attrs:{tag:"label",say:"include numbers",for:"settings-numbers"}})],1),t._v(" "),s("div",{staticClass:"setting"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.special,expression:"special"}],attrs:{type:"checkbox",id:"settings-special"},domProps:{checked:Array.isArray(t.special)?t._i(t.special,null)>-1:t.special},on:{change:function(e){var s=t.special,a=e.target,r=!!a.checked;if(Array.isArray(s)){var n=t._i(s,null);a.checked?n<0&&(t.special=s.concat([null])):n>-1&&(t.special=s.slice(0,n).concat(s.slice(n+1)))}else t.special=r}}}),t._v(" "),s("translate",{attrs:{tag:"label",say:"include special characters",for:"settings-special"}})],1)],1)])};j._withStripped=!0;var F={components:{Translate:i.a},data(){let t=b.a.get("client.ui.section.default"),e=b.a.get("user.password.security.age"),s=b.a.get("user.password.generator.numbers"),a=b.a.get("user.password.generator.special"),r=b.a.get("user.password.generator.strength"),n=b.a.get("user.password.security.duplicates"),i=e>0,o=-1===[0,90,180,356,712].indexOf(e)&&e;return 0===e&&(e=356),{section:t,duplicates:n,customAge:o,strength:r,numbers:s,special:a,hasAge:i,maxAge:e}},methods:{},watch:{hasAge(t){b.a.set("user.password.security.age",t?this.maxAge:0)},maxAge(t){b.a.set("user.password.security.age",this.hasAge?t:0)},duplicates(t){b.a.set("user.password.security.duplicates",t)},section(t){b.a.set("client.ui.section.default",t)},strength(t){b.a.set("user.password.generator.strength",t)},numbers(t){b.a.set("user.password.generator.numbers",!0===t)},special(t){b.a.set("user.password.generator.special",!0===t)}}},N=(s(387),Object(c.a)(F,j,[],!1,null,null,null));N.options.__file="src/vue/Dialog/SetupDialog/UserSettings.vue";var q=N.exports,I=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("li",[s("p",[s("translate",{attrs:{say:"Passwords can be customized in a lot of different ways."}}),t._v(" "),s("translate",{attrs:{say:"As administrator you might want to take a look at these common settings."}})],1),t._v(" "),s("div",{staticClass:"apdmin-settings-container"},[s("translate",{attrs:{tag:"label",say:"Check password security with"}}),t._v(" "),s("select",{directives:[{name:"model",rawName:"v-model",value:t.settings.security.value,expression:"settings.security.value"}],on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.settings.security,"value",e.target.multiple?s:s[0])}}},t._l(t.settings.security.options,(function(t,e){return s("translate",{key:e,attrs:{tag:"option",value:t.value,say:t.label,disabled:!t.available}})})),1),t._v(" "),s("translate",{attrs:{tag:"label",say:"Generate passwords using"}}),t._v(" "),s("select",{directives:[{name:"model",rawName:"v-model",value:t.settings.words.value,expression:"settings.words.value"}],on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.settings.words,"value",e.target.multiple?s:s[0])}}},t._l(t.settings.words.options,(function(t,e){return s("translate",{key:e,attrs:{tag:"option",value:t.value,say:t.label,disabled:!t.available}})})),1),t._v(" "),s("translate",{attrs:{tag:"label",say:"Get favicons from"}}),t._v(" "),s("select",{directives:[{name:"model",rawName:"v-model",value:t.settings.favicon.value,expression:"settings.favicon.value"}],on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.settings.favicon,"value",e.target.multiple?s:s[0])}}},t._l(t.settings.favicon.options,(function(t,e){return s("translate",{key:e,attrs:{tag:"option",value:t.value,say:t.label,disabled:!t.available}})})),1),t._v(" "),s("translate",{attrs:{tag:"label",say:"Get website previews from"}}),t._v(" "),s("select",{directives:[{name:"model",rawName:"v-model",value:t.settings.preview.value,expression:"settings.preview.value"}],on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.settings.preview,"value",e.target.multiple?s:s[0])}}},t._l(t.settings.preview.options,(function(t,e){return s("translate",{key:e,attrs:{tag:"option",value:t.value,say:t.label,disabled:!t.available}})})),1),t._v(" "),s("translate",{attrs:{tag:"label",say:"Make backups"}}),t._v(" "),s("select",{directives:[{name:"model",rawName:"v-model",value:t.settings.backups.value,expression:"settings.backups.value"}],on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.settings.backups,"value",e.target.multiple?s:s[0])}}},t._l(t.settings.backups.options,(function(t,e){return s("translate",{key:e,attrs:{tag:"option",value:t.value,say:t.label,disabled:!t.available}})})),1)],1),t._v(" "),s("translate",{staticClass:"cta-admin-settings",attrs:{tag:"a",icon:"cog",href:t.getAppSettingsLink,target:"_blank",say:"View all settings"}}),t._v(" "),s("translate",{staticClass:"admin-notes",attrs:{tag:"a",href:"https://git.mdns.eu/nextcloud/passwords/wikis/Administrators/Administrator-Notes",target:"_blank",say:"Read our tips for admins"}})],1)};I._withStripped=!0;var R=s(6),$=s(103),B={components:{Translate:i.a},data:()=>({api:new $.a,settings:{security:{value:null,options:{}},words:{value:null,options:{}},favicon:{value:null,options:{}},preview:{value:null,options:{}},backups:{value:null,options:{}}},oldSettings:{}}),created(){this.api.get("service.security").then(t=>{this.settings.security=t}),this.api.get("service.words").then(t=>{this.settings.words=t}),this.api.get("service.favicon").then(t=>{this.settings.favicon=t}),this.api.get("service.preview").then(t=>{this.settings.preview=t}),this.api.get("backup.interval").then(t=>{this.settings.backups=t})},computed:{getAppSettingsLink:()=>R.a.generateUrl("/settings/admin/passwords")},watch:{settings:{handler(t){for(let e in t)t.hasOwnProperty(e)&&this.oldSettings.hasOwnProperty(e)&&t[e].value!==this.oldSettings[e].value&&null!==this.oldSettings[e].value&&(t[e].value!==t[e].default?this.api.set(t[e].name,t[e].value):this.api.reset(t[e].name));this.oldSettings=JSON.parse(JSON.stringify(t))},deep:!0}}},z=(s(389),Object(c.a)(B,I,[],!1,null,null,null));z.options.__file="src/vue/Dialog/SetupDialog/AdminSettings.vue";var G=z.exports,K={components:{UserSettings:q,Integrations:D,Encryption:x,Translate:i.a,KeepOrder:f,GetHelp:y,Start:d,AdminSettings:G},props:{enableSlides:{type:Array,default(){let t=["start","user-settings","get-help","integrations"];if(r.a.hasEncryption||t.splice(1,0,"encryption"),OC.isUserAdmin()){let e=t.indexOf("user-settings");t.splice(e,0,"admin-settings")}return t}},closable:{type:Boolean,default:!1},redirect:{type:Boolean,default:!0},_close:{type:Function}},data(){let t=[{title:"A safe home for your passwords",id:"start"},{title:"Keep your passwords secret",skippable:!0,action:null,id:"encryption"},{title:"Customize your experience",id:"admin-settings"},{title:"Customize your experience",id:"user-settings"},{title:"Bring order to your passwords",id:"keep-order"},{title:"Find help when you need it",id:"get-help"},{title:"Get connected",id:"integrations"}];for(let e=0;e<t.length;e++)-1===this.enableSlides.indexOf(t[e].id)&&(t.splice(e,1),e--);return{current:t[0],currentId:0,isDefaultRoute:!0,route:{path:"/"},slides:t}},computed:{getStyle(){return this.currentId<1?"":window.innerWidth>900?`transform: translateX(-${900*this.currentId}px);`:`transform: translateX(-${100*this.currentId}vw);`},continueText(){return this.currentId===this.slides.length-1?"Close":"Continue"},showSkipButton(){return this.current.skippable},showCustomButton(){return this.current.hasOwnProperty("action")&&null!==this.current.action}},methods:{hasSlide(t){return-1!==this.enableSlides.indexOf(t)},goToSlide(t){this.slides.hasOwnProperty(t)&&(this.current=this.slides[t],this.currentId=t)},nextSlide(){this.currentId<this.slides.length-1?this.goToSlide(this.currentId+1):this.closeWizard()},openSection(t,e=!0){this.route=t,this.isDefaultRoute=!1,e&&this.closeWizard()},updateStatus(t){t.id===this.current.id&&(t.hasOwnProperty("skippable")&&(this.current.skippable=!0===t.skippable),t.hasOwnProperty("action")&&(this.current.action=t.action))},closeWizard(){b.a.set("client.setup.initialized",!0),this.$destroy();let t=document.getElementById("app-popup"),e=document.createElement("div");t.replaceChild(e,t.childNodes[0]),!this.redirect&&this.isDefaultRoute||n.a.push(this.route),this._close&&this._close()},closeAction(t){this.closable&&"passwords-setup"===t.target.id&&this.current.skippable&&this.closeWizard()}}},M=(s(391),Object(c.a)(K,a,[],!1,null,null,null));M.options.__file="src/vue/Dialog/SetupDialog.vue";e.default=M.exports},309:function(t,e,s){"use strict";var a=s(0),r=s(6),n=s(2),i=s(45),o=s(1),l=s(102),c=s(5);e.a=new class{constructor(){this._statusFunc=null,this.status=null}async install(t,e=!1,s=!1,a=null){if(this._resetStatus(a),await this._updateKeychain(t),!1!==s){let t={},e={};await Promise.all([this._encryptTags(t),this._encryptFolders(e)]),await this._encryptPasswords(e,t),await this._cleanDatabase(t,e)}e&&await this._saveMasterPassword(t),i.a.loginRequired=!0}async update(t,e){try{await a.a.setAccountChallenge(t,e)}catch(t){throw t}}async updateGui(){let t=await n.a.form({password:{label:"New password",type:"password",button:"toggle",minlength:12,required:!0,title:"Your password must be longer than 12 characters and not the old password",validator:(t,e)=>t!==e.oldPassword&&t.length>=12},repeatPassword:{label:"Repeat password",type:"password",button:"toggle",required:!0,title:"Please confirm your new password",validator:(t,e)=>t===e.password},oldPassword:{label:"Old password",type:"password",button:"toggle",title:"You must enter your old password",required:!0,validator:t=>t.length>=12}},"Change Password","You can use this dialog to change your master password.");try{this._lockApp(),await this.update(t.password,t.oldPassword),this._unlockApp(),n.a.alert("Your password has been changed successfully.","Password changed")}catch(t){this._unlockApp(),n.a.alert(t.message,"Changing password failed"),console.error(t)}}async _updateKeychain(t){this._sendStatus("keychain","processing",1);try{await a.a.setAccountChallenge(t),await Promise.all([await c.a.reset("user.encryption.cse"),await c.a.reset("user.encryption.sse")]),this._sendStatus("keychain","done")}catch(t){throw this._sendStatus("keychain","error",t),t}}async _encryptPasswords(t,e){this._sendStatus("passwords","loading");let s=await a.a.listPasswords("model+tags"),r=[];this._sendStatus("passwords","processing",Object.keys(s).length);for(let a in s){if(!s.hasOwnProperty(a))continue;let n=s[a];r.push(this._encryptPassword(n,t,e)),r.length>15&&(await Promise.all(r),r=[])}0!==r.length&&await Promise.all(r),this._sendStatus("passwords","done")}async _encryptPassword(t,e,s,r,n){t.folder=e[t.folder];let i=[];for(let e in t.tags)t.tags.hasOwnProperty(e)&&i.push(s[e]);if(t.tags=i,t.shared||null!==t.share)try{await a.a.updatePassword(t),console.log("Updated password "+t.id),this._sendStatus("passwords")}catch(t){throw this._sendStatus("passwords","error",t),t}else{await this._deleteObject(t.id,"password"),t.cseType="CSEv1r1";try{await a.a.createPassword(t),console.log("Encrypted password "+t.id),this._sendStatus("passwords")}catch(t){throw this._sendStatus("passwords","error",t),t}}}async _encryptTags(t){this._sendStatus("tags","loading");let e=await a.a.listTags(),s=[];this._sendStatus("tags","processing",Object.keys(e).length);for(let a in e)e.hasOwnProperty(a)&&(s.push(this._encryptTag(e[a],t)),s.length>10&&(await Promise.all(s),s=[]));return 0!==s.length&&await Promise.all(s),this._sendStatus("tags","done"),t}async _encryptTag(t,e){try{t.cseType="CSEv1r1";let s=await a.a.createTag(t);e[t.id]=s.id,this._sendStatus("tags"),console.log("Encrypted tag "+t.id)}catch(t){throw this._sendStatus("tags","error",t),t}}async _encryptFolders(t){this._sendStatus("folders","loading");let e=await a.a.listFolders(),s=[];t["00000000-0000-0000-0000-000000000000"]="00000000-0000-0000-0000-000000000000",e=this._sortFoldersForUpgrade(e),this._sendStatus("folders","processing",Object.keys(e).length);for(let a in e){if(!e.hasOwnProperty(a))continue;let r=e[a];(!t.hasOwnProperty(r.parent)||s.length>10)&&(await Promise.all(s),s=[]),s.push(this._encryptFolder(r,t))}return await Promise.all(s),this._sendStatus("folders","done"),t}async _encryptFolder(t,e){try{t.parent=e[t.parent],t.cseType="CSEv1r1";let s=await a.a.createFolder(t);e[t.id]=s.id,this._sendStatus("folders"),console.log("Encrypted folder "+t.id)}catch(t){throw this._sendStatus("folders","error",t),t}}_sortFoldersForUpgrade(t){let e=[],s=["00000000-0000-0000-0000-000000000000"];for(t=r.a.objectToArray(t);0!==t.length;)for(let a=0;a<t.length;a++){let r=t[a];-1!==s.indexOf(r.parent)&&(s.push(r.id),e.push(r),t.splice(a,1),a--)}return e}async _cleanDatabase(t,e){let s=Object.keys(t).length+Object.keys(e).length;this._sendStatus("cleanup","processing",s),l.a.ignoreApiErrors=!0,await Promise.all([this._deleteObjects(t,"tag"),this._deleteObjects(e,"folder")]),l.a.ignoreApiErrors=!1,this._sendStatus("cleanup","done")}async _deleteObjects(t,e){let s=[];for(let a in t)t.hasOwnProperty(a)&&"00000000-0000-0000-0000-000000000000"!==a&&(s.push(this._deleteObject(a,e)),s.length>10&&(await Promise.all(s),s=[]));0!==s.length&&await Promise.all(s)}async _deleteObject(t,e){let s="delete"+e.capitalize();try{await a.a[s](t),await a.a[s](t)}catch(t){t.hasOwnProperty("id")&&404===t.id||this._sendStatus("cleanup","error",t)}"password"!==e&&this._sendStatus("cleanup","processing")}async _saveMasterPassword(t){this._sendStatus("password","processing",1);let e=document.querySelector("meta[name=api-user]").getAttribute("content"),s=o.a.translate("Passwords App Master Password"),r=location.href;try{await a.a.createPassword({username:e,password:t,label:s,url:r}),this._sendStatus("password","done")}catch(t){this._sendStatus("password","error",t)}}_resetStatus(t){this._statusFunc=t,this.status={passwords:{status:"waiting",total:0,current:0,errors:[]},keychain:{status:"waiting",total:0,current:0,errors:[]},folders:{status:"waiting",total:0,current:0,errors:[]},cleanup:{status:"waiting",total:0,current:0,errors:[]},tags:{status:"waiting",total:0,current:0,errors:[]},save:{status:"waiting",total:0,current:0,errors:[]}}}_sendStatus(t,e="processing",s=null){if(null===this._statusFunc||!this.status.hasOwnProperty(t))return;let a=this.status[t];"processing"===e?(a.status="processing",null!==s?(a.total=s,a.current=0):a.current++):"loading"===e?a.status="loading":"done"===e?(a.status=0===a.errors.length?"success":"failed","success"===a.status&&(a.current=a.total)):"error"===e&&(console.error(s),a.errors.push(s),"cleanup"!==t&&(a.status="failed")),this._statusFunc(this.status)}_unlockApp(){document.getElementById("settings-reset").remove(),document.getElementById("app").classList.remove("blocking")}_lockApp(){document.getElementById("app").classList.add("blocking");let t=document.createElement("div");t.setAttribute("id","settings-reset"),t.classList.add("loading"),document.getElementById("app-content").appendChild(t)}}},318:function(t,e,s){var a=s(378);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,s(12).default)("74f155fd",a,!1,{})},319:function(t,e,s){var a=s(380);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,s(12).default)("54616a5d",a,!1,{})},320:function(t,e,s){var a=s(382);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,s(12).default)("6a545add",a,!1,{})},321:function(t,e,s){var a=s(384);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,s(12).default)("11e0596b",a,!1,{})},322:function(t,e,s){var a=s(386);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,s(12).default)("7382773a",a,!1,{})},323:function(t,e,s){var a=s(388);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,s(12).default)("3ab6b7c1",a,!1,{})},324:function(t,e,s){var a=s(390);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,s(12).default)("9f855006",a,!1,{})},325:function(t,e,s){var a=s(392);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,s(12).default)("1679b2aa",a,!1,{})},377:function(t,e,s){"use strict";var a=s(318);s.n(a).a},378:function(t,e,s){},379:function(t,e,s){"use strict";var a=s(319);s.n(a).a},380:function(t,e,s){},381:function(t,e,s){"use strict";var a=s(320);s.n(a).a},382:function(t,e,s){},383:function(t,e,s){"use strict";var a=s(321);s.n(a).a},384:function(t,e,s){},385:function(t,e,s){"use strict";var a=s(322);s.n(a).a},386:function(t,e,s){},387:function(t,e,s){"use strict";var a=s(323);s.n(a).a},388:function(t,e,s){},389:function(t,e,s){"use strict";var a=s(324);s.n(a).a},390:function(t,e,s){},391:function(t,e,s){"use strict";var a=s(325);s.n(a).a},392:function(t,e,s){}}]);